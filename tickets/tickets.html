<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticket Management - MoneyMind Admin</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="tickets.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script defer src="../userbutton/script_nouser.js"></script>
    <!--<script src="is_admin.js"></script>-->
</head>
<body onload="ensureCaptcha()">
    <nav class="navbar">
        <div class="nav-logo">
            <h2>Money<span>Mind</span> Admin</h2>
        </div>
        <ul class="nav-links">
            <li><a href="../index.html">Dashboard</a></li>
            <li><a href="../invest/invest.html">Invest</a></li>
            <li><a href="../news/news.html">News</a></li>
            <li><a href="../profile/profile.html">Profile</a></li>
            <li><a href="../support/support.html">Support</a></li>
            <li><a href="../admin/admin.html">Admin</a></li>
            <li><a href="#" class="active">Tickets</a></li>
        </ul>
        <button id="logoutBtn" class="logout-btn"></button>
    </nav>
    <span id="userName" class="user-pill"></span>
    <div class="dashboard">
        <div id="accessDenied" class="access-denied hidden">
            <div class="access-denied-content">
                <div class="access-denied-icon">üö´</div>
                <h2>Access Denied</h2>
                <p>This page is restricted to administrators only.</p>
                <p>You do not have permission to access the ticket management system.</p>
                <button onclick="window.location.href='../index.html'" class="primary-btn">
                    Return to Dashboard
                </button>
            </div>
        </div>

        <div id="adminContent" class="hidden">
            <div class="dashboard-header">
                <div>
                    <div class="subtitle">Admin Panel</div>
                    <h2>Support Ticket Management</h2>
                    <p class="muted">Manage and respond to user support tickets.</p>
                </div>
                <div class="header-actions">
                    <div class="header-pill" id="ticketStats">Loading stats...</div>
                    <button class="primary-ghost" onclick="refreshTickets()">
                        <span class="refresh-icon">‚Üª</span> Refresh
                    </button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card admin">
                    <div class="card-value" id="openTicketsCount">0</div>
                    <div class="card-label">Open Tickets</div>
                </div>
                <div class="stat-card admin">
                    <div class="card-value" id="urgentTicketsCount">0</div>
                    <div class="card-label">Urgent</div>
                </div>
                <div class="stat-card admin">
                    <div class="card-value" id="inProgressCount">0</div>
                    <div class="card-label">In Progress</div>
                </div>
                <div class="stat-card admin">
                    <div class="card-value" id="responseRate">0%</div>
                    <div class="card-label">Response Rate</div>
                </div>
            </div>

            <div class="card">
                <div class="filters-row">
                    <div class="filter-group">
                        <label>Status:</label>
                        <select id="adminStatusFilter" onchange="filterAdminTickets()">
                            <option value="all">All Tickets</option>
                            <option value="open">Open</option>
                            <option value="in_progress">In Progress</option>
                            <option value="closed">Closed</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Type:</label>
                        <select id="adminTypeFilter" onchange="filterAdminTickets()">
                            <option value="all">All Types</option>
                            <option value="technical">Technical</option>
                            <option value="platform_bug">Platform Bug</option>
                            <option value="account_issue">Account Issue</option>
                            <option value="feature_request">Feature Request</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Priority:</label>
                        <select id="adminPriorityFilter" onchange="filterAdminTickets()">
                            <option value="all">All Priorities</option>
                            <option value="urgent">Urgent</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Sort by:</label>
                        <select id="adminSortFilter" onchange="filterAdminTickets()">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="priority">Priority</option>
                            <option value="updated">Recently Updated</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Tickets Container cu douƒÉ box-uri separate -->
            <div class="tickets-container-vertical">
                <!-- Active Tickets Section -->
                <div class="card">
                    <div class="tickets-header">
                        <h3>üéØ Active Tickets</h3>
                        <div class="header-badge" id="activeTicketsCount">0</div>
                    </div>
                    
                    <div id="activeTicketsList" class="admin-tickets-list">
                        <div class="loading-state">Loading active tickets...</div>
                    </div>
                </div>

                <!-- Closed Tickets Section -->
                <div class="card">
                    <div class="tickets-header">
                        <h3>üìÅ Closed Tickets</h3>
                        <div class="header-badge" id="closedTicketsCount">0</div>
                    </div>
                    
                    <div id="closedTicketsList" class="admin-tickets-list">
                        <div class="loading-state">Loading closed tickets...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="adminTicketModal" class="modal">
        <div class="modal-content admin-modal">
            <div class="modal-header">
                <div>
                    <h3 id="adminModalTitle">Ticket Details</h3>
                    <div class="ticket-info-bar" id="ticketInfoBar"></div>
                </div>
                <span class="close-modal" onclick="closeAdminTicketModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="admin-chat-container">
                    <div id="adminTicketChat" class="ticket-chat">
                        <div class="loading-state">Loading messages...</div>
                    </div>
                    <div class="admin-reply-section">
                        <div class="admin-actions">
                            <select id="ticketStatus" onchange="updateTicketStatus()">
                                <option value="open">Open</option>
                                <option value="in_progress">In Progress</option>
                                <option value="closed">Closed</option>
                            </select>
                            <select id="ticketPriority" onchange="updateTicketPriority()">
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                            <button class="secondary-btn" onclick="closeTicket()" id="closeTicketBtn">Close Ticket</button>
                        </div>
                        <textarea id="adminReplyMessage" placeholder="Type your response here..."></textarea>
                        <button onclick="sendAdminReply()" class="primary-btn">Send Response</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="createTicketModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Ticket</h3>
                <span class="close-modal" onclick="closeCreateTicketModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="createTicketForm" class="ticket-form">
                    <div class="form-group">
                        <label for="newTicketTitle">Title</label>
                        <input type="text" id="newTicketTitle" name="title" placeholder="Enter ticket title" required>
                    </div>
                    <div class="form-group">
                        <label for="newTicketType">Type</label>
                        <select id="newTicketType" name="type" required>
                            <option value="technical">Technical Issue</option>
                            <option value="platform_bug">Platform Bug</option>
                            <option value="account_issue">Account Issue</option>
                            <option value="feature_request">Feature Request</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="newTicketPriority">Priority</label>
                        <select id="newTicketPriority" name="priority" required>
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="newTicketDescription">Description</label>
                        <textarea id="newTicketDescription" name="description" placeholder="Enter ticket description..." rows="5" required></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="secondary-btn" onclick="closeCreateTicketModal()">Cancel</button>
                        <button type="submit" class="primary-btn">Create Ticket</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="tickets.js"></script>
</body>
</html>
